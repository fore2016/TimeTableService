package com.yg.timetableservice.rxjava;


import com.alibaba.fastjson.JSONArray;
import com.yg.timetableservice.struct.HISResult;
import rx.functions.Func1;

import java.text.SimpleDateFormat;
import java.util.Calendar;

public class GetResultMapper implements Func1<JSONArray, JSONArray> {
    @Override
    public JSONArray call(JSONArray allturns) {
        JSONArray result = new JSONArray();
        SimpleDateFormat sdf = new SimpleDateFormat("HH:mm");

        for (Object o : allturns) {
            Calendar arriveTime = (Calendar)((JSONArray)o).get(1);
            String dateStr = sdf.format(arriveTime.getTime());
            HISResult hisResult = new HISResult();
            hisResult.maxArrivalTime = hisResult.minArrivalTime = hisResult.bestArrivalTime = dateStr;
            Calendar calendar = Calendar.getInstance();
            if (arriveTime.get(Calendar.DAY_OF_YEAR) == calendar.get(Calendar.DAY_OF_YEAR) + 1) {
                hisResult.nextDayFlag = 1;
            } else {
                hisResult.nextDayFlag = 0;
            }
            result.add(hisResult);
        }
        return result;
    }
}
