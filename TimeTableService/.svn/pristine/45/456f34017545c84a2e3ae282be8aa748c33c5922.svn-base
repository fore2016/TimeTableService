package com.yg.timetableservice.rxjava;


import com.alibaba.fastjson.JSONArray;
import com.alibaba.fastjson.JSONObject;
import com.yg.timetableservice.struct.HISResult;
import com.yg.timetableservice.struct.PositionTurn;
import com.yg.timetableservice.struct.ReturnResult;
import com.yg.timetableservice.util.TimeUtil;
import rx.functions.Func1;

import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.List;

public class GetResultMapper implements Func1<JSONArray, ReturnResult> {
    @Override
    public ReturnResult call(JSONArray allturns) {
        List<HISResult> data = new ArrayList<>();

        for (Object o : allturns) {
            String arriveTime = ((PositionTurn)o).turn.arriveTime;
            TimeUtil timeUtil = new TimeUtil(arriveTime);
            String dateStr = timeUtil.getHour24() + ":" + timeUtil.getMinute();
            HISResult hisResult = new HISResult();
            hisResult.maxArrivalTime = hisResult.minArrivalTime = hisResult.bestArrivalTime = dateStr;
            hisResult.accuracy = ((PositionTurn)o).turn.accuracy;
            int type = ((PositionTurn)o).turn.isFaked;
            switch (type) {
                case 0:
                    hisResult.dataSource = "history";
                    break;
                case 1:
                    hisResult.dataSource = "forge";
                    break;
                default:
                    hisResult.dataSource = "forge";
            }
            if (timeUtil.ifNextDay()) {
                hisResult.nextDayFlag = 1;
            } else {
                hisResult.nextDayFlag = 0;
            }
            hisResult.nextStopOrder = ((PositionTurn)o).nextStopOrder;
            data.add(hisResult);
        }
        ReturnResult returnResult = new ReturnResult();
        ReturnResult.HttpReturnResult httpReturnResult = new ReturnResult.HttpReturnResult();
        httpReturnResult.data = data;
        returnResult.jsonr = httpReturnResult;
        return returnResult;
    }
}
